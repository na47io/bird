<div id="<%= dom_id post %>">
</div>
<div class="post">
  <div class="post-header">
    <div class="post-meta">
      <div class="author"><%= post.author %></div>
      <div class="timestamp"><%= time_ago_in_words(post.created_at) %> ago</div>
    </div>
    <button class="reply-button" onclick="document.getElementById('reply-dialog-<%= post.id %>').showModal()">Reply</button>
  </div>
  
  <div class="post-content">
    <div class="body"><%= highlight_hashtags(post.body) %></div>
    <% if post.hash_tags.any? %>
      <div class="tags">
        <% post.hash_tags.each do |tag| %>
          <span class="tag"><%= tag.name %></span>
        <% end %>
      </div>
    <% end %>
  </div>
  
  <% if post.replies.any? %>
    <div data-controller="replies" 
         data-replies-count-value="<%= post.replies.count %>"
         data-replies-search-value="<%= @query.present? %>">
      <button 
        data-action="replies#toggle" 
        data-replies-target="count"
        class="replies-toggle">
        Hide replies
      </button>
      
      <div class="replies" data-replies-target="replies">
      <% post.replies.each do |reply| %>
        <div class="reply">
          <div class="author"><%= reply.author %></div>
          <div class="body"><%= reply.body %></div>
          <div class="timestamp"><%= time_ago_in_words(reply.created_at) %> ago</div>
        </div>
      <% end %>
      </div>
    </div>
  <% end %>
  
  <dialog id="reply-dialog-<%= post.id %>" class="reply-dialog">
    <%= form_for [post, Reply.new], html: { class: "reply-form" } do |f| %>
      <div>
        <%= f.label :author %>
        <%= f.text_field :author %>
      </div>
      
      <div>
        <%= f.label :body %>
        <%= f.text_area :body %>
      </div>
      
      <%= f.submit "Post Reply", class: "reply-button" %>
      <button type="button" onclick="this.closest('dialog').close()">Cancel</button>
    <% end %>
  </dialog>
</div>
